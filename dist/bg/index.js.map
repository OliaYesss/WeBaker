{
  "version": 3,
  "sources": ["../../src/shared/calcDuration.js", "../../src/shared/storageState.js", "../../src/bg/index.js"],
  "sourcesContent": ["export function dateToKey(date) {\n  return date.toLocaleDateString()\n}\n\nexport function getTodayKey() {\n  return dateToKey(new Date)\n}\n\nexport function calcWeeklyDuration(sessionMap) {\n  if (!sessionMap) {\n    return 0\n  }\n\n  let res = 0\n  let curDay = new Date()\n\n  for (let i = 0; i < 7; i++) {\n    res += sessionMap[dateToKey(curDay)] ?? 0\n    curDay.setDate(curDay.getDate() - 1)\n  }\n\n  return res\n}\n\nexport function calcDailyDuration(sessionMap) {\n  if (!sessionMap) {\n    return 0\n  }\n\n  const todayKey = getTodayKey()\n  return sessionMap[todayKey] ?? 0\n}\n\nexport function getRuntimeUsageDuration(duration, durationSiteId, currentSession) {\n  const nowTimestamp = Date.now()\n\n  return duration + (\n    currentSession && currentSession.siteId === durationSiteId\n    ? nowTimestamp - currentSession.startTimestamp\n    : 0\n  )\n}\n", "const DEFAULT_SITE_MAP = {\n  0: {\n    domain: 'facebook.com',\n    name: 'Facebook',\n    status: true,\n    maxDurationInMins: 30\n  },\n  1: {\n    domain: 'instagram.com',\n    name: 'Instagram',\n    status: true,\n    maxDurationInMins: 30\n  },\n  2: {\n    domain: 'twitter.com',\n    name: 'Twitter',\n    status: true,\n    maxDurationInMins: 30\n  },\n  3: {\n    domain: 'youtube.com',\n    name: 'YouTube',\n    status: true,\n    maxDurationInMins: 30\n  }\n}\n\nexport const ADDED_BY_USER_START_ID = Math.max(...Object.keys(DEFAULT_SITE_MAP).map(x => parseInt(x))) + 1\n\nexport class StorageState {\n  static get() {\n    return chrome.storage.local.get(null).then(state => ({\n      ...state,\n      currentSession: state.currentSession ?? null,\n      sessionMap: state.sessionMap ?? {},\n      siteMap: state.siteMap ?? DEFAULT_SITE_MAP\n    }))\n  }\n\n  static set(newValue) {\n    return chrome.storage.local.set(newValue)\n  }\n\n  static removeSessonMap() {\n    return chrome.storage.local.set({ sessionMap: {} })\n  }\n}\n", "import { getTodayKey } from \"../shared/calcDuration\"\nimport { StorageState } from \"../shared/storageState\"\n\nconst EVENT = {\n  activeTabChanged: 'activeTabChanged',\n  tabUpdated: 'tabUpdated',\n  windowFocusChanged: 'windowFocusChanged'\n}\n\nasync function handleChange(_event, tab) {\n  const { siteMap, currentSession, sessionMap } = await StorageState.get()\n  const currentTimestamp = Date.now()\n  let newSession = null\n\n  if (tab) {\n    const siteId = Object.keys(siteMap).find(siteId => (\n      tab.url.includes(siteMap[siteId].domain) && siteMap[siteId].status\n    ))\n\n    if (currentSession && siteId === currentSession.siteId) {\n      newSession = currentSession\n    } else if (siteId) {\n      newSession = {\n        siteId,\n        startTimestamp: currentTimestamp\n      }\n    }\n  }\n\n  // console.log(_event, currentSession, newSession)\n\n  if (newSession && currentSession && currentSession.siteId === newSession.siteId) {\n    return\n  }\n\n  if (currentSession) {\n    const todayKey = getTodayKey()\n    const duration = currentTimestamp - currentSession.startTimestamp\n\n    if (!sessionMap[currentSession.siteId]) {\n      sessionMap[currentSession.siteId] = {}\n    }\n\n    if (!sessionMap[currentSession.siteId][todayKey]) {\n      sessionMap[currentSession.siteId][todayKey] = 0\n    }\n\n    sessionMap[currentSession.siteId][todayKey] += duration\n\n    StorageState.set({ currentSession: newSession, sessionMap })\n  } else {\n    StorageState.set({ currentSession: newSession })\n  }\n}\n\nfunction main() {\n  // listen tab change\n  chrome.tabs.onActivated.addListener(async () => {\n    const [ tab ] = await chrome.tabs.query( { active: true, lastFocusedWindow: true })\n    handleChange(EVENT.activeTabChanged, tab)\n  })\n\n  // listent tab update\n  chrome.tabs.onUpdated.addListener((_tabId, _changeInfo, tab) => {\n    handleChange(EVENT.tabUpdated, tab)\n  })\n\n  // listen browser focus\n  chrome.windows.onFocusChanged.addListener(async (window) => {\n    if (window === chrome.windows.WINDOW_ID_NONE) {\n      handleChange(EVENT.windowFocusChanged, null)\n    } else {\n      const [ tab ] = await chrome.tabs.query( { active: true, lastFocusedWindow: true })\n      handleChange(EVENT.windowFocusChanged, tab)\n    }\n  })\n}\n\nmain()\n"],
  "mappings": "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",
  "names": ["siteId"]
}
